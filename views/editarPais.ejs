<h1>Editar País</h1>

<form class="formulario-editar" action="/pais/actualizar/<%= pais._id || pais.id %>?_method=PUT" method="POST">
  <!--Nombre-->
  <label for="nombreOficial">Nombre común u oficial</label><br>
  <input type="text" name="nombreOficial" id="nombreOficial" class="<%= locals.errores && locals.errores.nombreOficial ? 'input-error' : '' %>" value="<%= pais.nombreOficial %>">
  <% if (locals.errores && locals.errores.nombreOficial) { %>
    <span class="msg-error"><%= locals.errores.nombreOficial %></span>
  <% } %>

  <br><br>

  <!--Capital-->
  <label>Capital</label><br>
  <div id="capital-container">
    <%let capitales = Array.isArray(pais.capital) ? pais.capital : [pais.capital];%>
    <%capitales.forEach(function(cap) {%>
      <div class="item-dinamico">
        <input type="text" name="capital[]" value="<%= cap %>">
        <button type="button" onclick="eliminarCampo(this)">X</button>
      </div>
    <% }) %>
  </div>
  <% if (locals.errores && locals.errores.capital) { %>
    <span class="msg-error"><%= locals.errores.capital %></span>
  <% } %>
  <button type="button" onclick="agregarCampo('capital-container','capital')">Agregar más capitales</button><br><br>

  <!--Poblacion-->
  <label for="population">Población</label><br>
  <input type="number" name="population" id="population" class="<%= locals.errores && locals.errores.population ? 'input-error' : '' %>" value="<%= pais.population %>">
  <% if (locals.errores && locals.errores.population) { %>
    <span class="msg-error"><%= locals.errores.population %></span>
  <% } %>

  <br><br>

  <!--Area-->
  <label for="area">Area (km²)</label><br>
  <input type="number" name="area" id="area" class="<%= locals.errores && locals.errores.area ? 'input-error' : '' %>" value="<%= pais.area %>">
  <% if (locals.errores && locals.errores.area) { %>
    <span class="msg-error"><%= locals.errores.area %></span>
  <% } %>

  <br><br>

  <!--Borders-->
  <label>Países limítrofes (Solo si tiene limites)</label><br>
  <div id="limitrofes-container">
    <% if (pais.borders && pais.borders.length > 0) { %>
      <%let limites = Array.isArray(pais.borders) ? pais.borders : [pais.borders];%>
      <%limites.forEach(function(frontera) {%>
        <div class="item-dinamico">
          <input type="text" name="borders[]" value="<%= frontera %>" oninput="this.value = this.value.toUpperCase()" placeholder="Ej: ARG">
          <button type="button" onclick="eliminarCampo(this)">X</button>
        </div>
      <% }) %>
    <% } else { %>
      <div class="item-dinamico">
        <input type="text" name="borders[]" oninput="this.value = this.value.toUpperCase()" placeholder="Ej: ARG">
        <button type="button" onclick="eliminarCampo(this)">X</button>
      </div>
    <% } %>
  </div>
  <% if (locals.errores && locals.errores.borders) { %>
    <span class="msg-error"><%= locals.errores.borders %></span>
  <% } %>
  <button type="button" onclick="agregarCampo('limitrofes-container','borders')">Agregar más límites</button><br><br>

  <!--Timezone-->
  <label>Zona horaria</label><br>
  <div id="timezones-container">
    <%let zonas = Array.isArray(pais.timezones) ? pais.timezones : [pais.timezones];%>
    <%zonas.forEach(function(zona) {%>
      <div class="item-dinamico">
        <input type="text" name="timezones[]" value="<%= zona %>" oninput="this.value = this.value.toUpperCase()" placeholder="Ej: UTC-03:00">
        <button type="button" onclick="eliminarCampo(this)">X</button>
      </div>
    <% }) %>
  </div>
  <% if (locals.errores && locals.errores.timezones) { %>
    <span class="msg-error"><%= locals.errores.timezones %></span>
  <% } %>
  <button type="button" onclick="agregarCampo('timezones-container','timezones')">Agregar más zonas</button><br><br>

  <!--Gini-->
  <label for="gini">Gini</label><br>
  <input type="number" name="gini" step="any" class="<%= locals.errores && locals.errores.gini ? 'input-error' : '' %>" value="<%= pais.gini || '' %>">
  <% if (locals.errores && locals.errores.gini) { %>
    <span class="msg-error"><%= locals.errores.gini %></span>
  <% } %>
  <br><br>

  <button type="submit">Actualizar País</button>
</form>

<script>
  // Esta función se dispara cuando tocas cualquier botón de "Agregar más..."
  // Recibe dos cosas: Dónde ponerlo (containerId) y qué tipo de input es (tipoInput)
  function agregarCampo(containerId, tipoInput) {

    // 1. Busco la caja grande (div) donde vamos a meter los nuevos campos
    const container = document.getElementById(containerId)

    // 2. Creo un div nuevo desde cero para agrupar el input y el botón de borrar
    const div = document.createElement("div")
    div.classList.add("item-dinamico") // Le pongo la clase para que se acomode bien (flex)

    let htmlInput = ''

    // 3. Chequeo qué tipo de campo pidió el usuario para armar el HTML correcto
    if (tipoInput === 'capital') {
      // name="capital[]" tiene corchetes para que Express sepa que es una lista
      htmlInput = '<input type="text" name="capital[]">'
    } else if (tipoInput === 'borders') {
      // Acá agrego el truco de "toUpperCase" para que se escriba en mayúsculas solo
      htmlInput = '<input type="text" name="borders[]" oninput="this.value = this.value.toUpperCase()" placeholder="Ej: BRA">'
    } else if (tipoInput === 'timezones') {
      htmlInput = '<input type="text" name="timezones[]" oninput="this.value = this.value.toUpperCase()" placeholder="Ej: UTC-03:00">'
    }

    // 4. Relleno el div con el input que armamos arriba Y le pego el botón de la "X"
    // El "onclick" del botón llama a la función de abajo pasándose a sí mismo (this)
    div.innerHTML = htmlInput + ' <button type="button" onclick="eliminarCampo(this)">X</button>'

    // 5. Finalmente, meto ese div nuevo dentro del contenedor visible
    container.appendChild(div)
  }

  // Esta función elimina el campo cuando tocan la X
  function eliminarCampo(btn) {
    // "btn" es el botón rojo. Su "parentElement" es el div que contiene al input y al botón.
    // Al hacer .remove(), borramos todo el renglón del HTML.
    btn.parentElement.remove()
  }
</script>